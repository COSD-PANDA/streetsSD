<!DOCTYPE html>
<html>
  <head>
    <title>Layer selector example | CartoDB.js</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.13/themes/css/cartodb.css" />
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div id="map"></div>
    <div id="helper_box" class="cartodb-infobox" style="display:none">
      <div id="1" style="display:none">
        <h3> Past Work </h3>
        <p>
          This is past work that has been done on streets
        </p>
      </div>
      <div id="2" style="display:none">
        <h3> Future Work </h3>
        <p>
          This is future work that will be done on streets.
        </p>
      </div>
       <div id="3" style="display:none">
        <h3> OCI </h3>
        <p>
          This is a streets condition assessment that was performed in 2011.  We are doing one again this year, and once we have it, we will publish the results. (link to article?);
        </p>
      </div>

    </div>
    <div id="layer_selector" class="cartodb-infobox">
      <ul id="work-layers">
        <li data="1">Past Work</li>
        <li data="2">Future Work</li>
        <li data="3">OCI as of 2011</li>
      </ul>
      <ul id="opt-layers">
        <li>
          <input type="checkbox" name="Show Districts" value="0">Show Council Districts</input>
        </li>
      </ul>

    <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.13/cartodb.js"></script>

    <script>
      var global = {
        workLayers: [1, 2, 3],
        optLayers: [0]
      };

      function clearState() {
        var num_sublayers = global.layers[1].getSubLayerCount();
        for (var i = 0; i < global.workLayers.length; i++) {
          global.layers[1].getSubLayer(global.workLayers[i]).hide();
          $('#helper_box').hide();
          $('#helper_box #' + global.workLayers[i]).hide();
        }
      }

      function initSubLayerWatch() {
        clearState();
        var $optLayers = $('#layer_selector ul#opt-layers li');
        $optLayers.click(function(e) {
          var $li = $(e.target);
          var $input = $('input', $li);
          $input.prop('checked') == true ? $input.prop('checked', false) : $input.prop('checked', true);
          var subLayer = global.layers[1].getSubLayer(0);
          subLayer.toggle();
        });

        var $workLayers = $('#layer_selector ul#work-layers li');
        $workLayers.click(function(e) {
          // get the area of the selected layer
          var $li = $(e.target);
          var subLayerNum = $li.attr('data');
          clearState();
          global.layers[1].getSubLayer(subLayerNum).show();
          $('#helper_box').show();
          $('#helper_box #' + subLayerNum).show();

          // deselect all and select the clicked one
          $workLayers.removeClass('selected');
          $li.addClass('selected');
        });
      }

      /*function createSelector(layer) {
        var sql = new cartodb.SQL({ user: 'maksim2' });

        var $options = $('#layer_selector li');
        $options.click(function(e) {
          // get the area of the selected layer
          var $li = $(e.target);
          var operation = $li.attr('data');

          // deselect all and select the clicked one
          $options.removeClass('selected');
          $li.addClass('selected');

          // create query based on data from the layer
          //var query = "select * from european_countries_e";

          if(area !== 'all') {
            query = "select * from european_countries_e where area > " + area;
          }
          //q = queries.pastWork;

          // change the query in the layer to update the map
          layer.setSQL(query);
        });
      }*/

      function main() {
        cartodb.createVis('map', 'https://maksim2.cartodb.com/api/v2/viz/02ae0d82-e463-11e4-addc-0e018d66dc29/viz.json', {
          tiles_loader: true,
          center_lat: 32.7150,
          center_lon: -117.1625,
          zoom: 10
        })
        .done(function(vis, layers) {
          //var subLayer = layers[1].getSubLayer(0);
          //createSelector(subLayer);
          //var sublayer = layers[1].getSubLayer(0);
          global.vis = vis;
          global.layers = layers;
          initSubLayerWatch();
        })
        .error(function(err) {
          console.log(err);
        });
      }

      window.onload = main;
    </script>
  </body>
</html>
